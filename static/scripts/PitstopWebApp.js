/* PitstopWebApp - 0.0.1 - 2014-10-20*/angular.module("pitstopWebApp",["ngRoute","map","card","directives.card","directives.search-bar","services.establishment","templates.app","templates.common"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"map/map.tpl.html",controller:"MapController"}).otherwise({redirectTo:"/"})}]).constant("MAP_API_URL","http://pitstop.dilimanlabs.com"),angular.module("card",["services.establishment","ngAnimate"]).controller("CardController",["$scope","CardFactory",function(a){a.calcFontSize=function(a){return a&&a.hasOwnProperty("length")?a.length<=20?"40px":a.length>20&&a.length<=40?"36px":"30px":void 0},a.selected.cardIndex=-1,a.changePageIndex=function(b){a.selected.cardIndex=a.selected.cardIndex!==b?b:-1}}]),angular.module("map",["google-maps","ngAnimate"]).controller("MapController",["$scope","EstablishmentsFactory","CardFactory",function(a,b,c){a.map={center:{latitude:14.581287,longitude:120.9762219},zoom:15,control:{},events:{idle:function(){a.loaded||("geolocation"in navigator&&navigator.geolocation.getCurrentPosition(a.getGeoLocation),a.loaded=!0),"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(a.setCurrentLocation);var c=a.map.control.getGMap(),d=c.getBounds(),e=d.getNorthEast(),f=d.getSouthWest();b.list({bounds:{ne:{lat:e.lat(),lon:e.lng()},sw:{lat:f.lat(),lon:f.lng()}}}).$promise.then(function(b){a.estabMarkers=b})},click:function(){a.$apply(function(){a.cardVisible=!1,a.show.pageList=!1,a.selected.cardIndex=-1})}},bounds:{}},a.cardVisible=!1,a.currentLocation={id:"currentLocation"},a.loaded=!1,a.getGeoLocation=function(b){a.map.center={latitude:b.coords.latitude,longitude:b.coords.longitude}},a.setCurrentLocation=function(b){a.currentLocation={latitude:b.coords.latitude,longitude:b.coords.longitude,id:"currentLocation"}},a.estabMarkers=[],a.cardModel={},a.cardPages=[],a.markersEvents={click:function(b,d,e){a.cardModel=e,a.cardPages=c.getPages({bizId:a.cardModel.bizId,estabId:a.cardModel.estabId}),a.$apply(function(){a.cardVisible=e.visible,a.show.pageList=!1,a.selected.cardIndex=-1})}},a.selected={cardIndex:-1},a.show={pageList:!1}}]),angular.module("directives.card",[]).directive("establishmentCard",function(){return{restrict:"E",templateUrl:"directives/card/card.tpl.html"}}).directive("cardPage",function(){return{restrict:"E",templateUrl:"directives/card/card-page.tpl.html"}}),angular.module("directives.search-bar",[]).directive("psSearchBar",function(){return{restrict:"E",templateUrl:"directives/search-bar/search-bar.tpl.html"}}),angular.module("services.establishment",["ngResource"]).factory("EstablishmentsFactory",["$resource","MAP_API_URL",function(a,b){return a(b+"/api/maps.list_establishments_from_bounds",{},{list:{method:"POST",transformResponse:function(a){a=JSON.parse(a);var b=[];return a.establishments.length>0&&(b=a.establishments.map(function(a){return{latitude:a.location.position.lat,longitude:a.location.position.lon,id:a.url.split("/")[6],bizId:a.url.split("/")[4],estabId:a.url.split("/")[6],details:{contact:a.contact.formattedPhone,address:a.location.address,name:a.name},visible:!0}})),b},isArray:!0}})}]).factory("CardFactory",["$resource","MAP_API_URL",function(a,b){return a(b+"/biz/:bizId/establishments/:estabId/full",{bizId:"@bizId",estabId:"@estabid"},{getEstab:{method:"GET"},getPages:{method:"GET",transformResponse:function(a){return a=JSON.parse(a),a.pages},isArray:!0}})}]),angular.module("templates.app",["map/map.tpl.html"]),angular.module("map/map.tpl.html",[]).run(["$templateCache",function(a){a.put("map/map.tpl.html",'<div class="container">\n    <google-map center="map.center" zoom="map.zoom" draggable="true" control="map.control" events="map.events" bounds="map.bounds" options="map.options">\n        <marker idKey="currentLocation.id" icon="\'marker_me.png\'" coords="currentLocation"></marker>\n        <markers models="estabMarkers" coords="\'self\'" events="markersEvents"></markers>\n    </google-map>\n    <ps-search-bar class="search"></ps-search-bar>\n    <establishment-card class="estab-info card-show-hide" ng-show="cardVisible" ng-controller="CardController"></establishment-card>\n</div>')}]),angular.module("templates.common",["directives/card/card-page.tpl.html","directives/card/card.tpl.html","directives/search-bar/search-bar.tpl.html"]),angular.module("directives/card/card-page.tpl.html",[]).run(["$templateCache",function(a){a.put("directives/card/card-page.tpl.html",'<div class="page">\n    <a href="{{ cardPages[currentPageIndex].url }}"><img ng-src="{{cardPages[currentPageIndex].imageUrl}}" height="80" alt="{{ cardModel.pages[currentPageIndex].description }}"></a>\n    <h3 ng-if="cardPages[currentPageIndex].products.length > 0">Products</h3>\n    <ul class="products" ng-if="cardPages[currentPageIndex].products.length > 0">\n        <li ng-repeat="product in cardPages[currentPageIndex].products" ng-class="{available: product.available}">\n            <a href="{{ product.url }}">Product</a>\n        </li>\n    </ul>\n</div>')}]),angular.module("directives/card/card.tpl.html",[]).run(["$templateCache",function(a){a.put("directives/card/card.tpl.html",'<div class="estab-details">\n    <h2 ng-bind="cardModel.details.name" ng-style="{\'font-size\': calcFontSize(cardModel.details.name)}"></h2>\n    <p class="estab-address" ng-bind="cardModel.details.address"></p>\n    <p class="estab-contact" ng-bind="cardModel.details.contact"></p>\n</div>\n<div class="estab-view-more">\n    <h4 ng-click="show.pageList = !show.pageList ">View More</h4>\n</div>\n<div class="page-list" ng-show="show.pageList">\n    <div class="page-list-header">\n        <button class="arrow left" ng-click="show.pageList = !show.pageList">\n            <svg ng-non-bindable xmlns="http://www.w3.org/2000/svg" width="24px" height="32px" viewBox="0 0 50 80" xml:space="preserve">\n                <polyline fill="none" stroke="#FFFFFF" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" points="45.63,75.8 0.375,38.087 45.63,0.375 "/>\n            </svg>\n        </button>\n    </div>\n    <div class="page-list-item" ng-repeat="page in cardPages" ng-style=" (selected.cardIndex == $index) ? {\'height\': \'90%\', \'top\': (-(90/cardPages.length)*$index)+\'%\', \'overflow-y\': \'auto\'} : {\'height\':(90/cardPages.length)+\'%\', \'top\': 0, \'overflow-y\': \'hidden\'}" ng-click="changePageIndex($index)">\n        <h2 ng-bind="page.title"></h2>\n        <img ng-src="{{page.imageUrl}}" width="300px">\n\n        <div class="product-list" ng-show="selected.cardIndex == $index">\n            <div class="product-list-item" ng-repeat="product in page.products">\n                <a href="{{product.url}}"><h3 class="product-title" ng-bind="product.name"></h3></a>\n                <img ng-src="{{product.imageUrl}}" width="200px">\n            </div>\n        </div>\n    </div>\n</div>')}]),angular.module("directives/search-bar/search-bar.tpl.html",[]).run(["$templateCache",function(a){a.put("directives/search-bar/search-bar.tpl.html",'<div class="search-bar">\n    <input type="text"/>\n    <button type="button">Search</button>\n</div>')}]);